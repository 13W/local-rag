<div class="flex flex-col h-full min-h-0">

  <div class="flex items-center gap-3 mb-0.5">
    <svg width="40" height="40" viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
      <defs>
        <radialGradient id="lg" cx="50%" cy="50%" r="50%">
          <stop offset="0%"   stop-color="#7dd3fc" stop-opacity="0.18" />
          <stop offset="100%" stop-color="#7dd3fc" stop-opacity="0" />
        </radialGradient>
      </defs>
      <circle cx="20" cy="20" r="18" fill="url(#lg)" />
      <polygon points="20,2 35,11 35,29 20,38 5,29 5,11" fill="none" stroke="#a5b4fc" stroke-width="0.8" stroke-opacity="0.45" />
      <line x1="20" y1="20" x2="20" y2="2"  stroke="#7dd3fc" stroke-width="0.7" stroke-opacity="0.35" />
      <line x1="20" y1="20" x2="35" y2="11" stroke="#7dd3fc" stroke-width="0.7" stroke-opacity="0.35" />
      <line x1="20" y1="20" x2="35" y2="29" stroke="#7dd3fc" stroke-width="0.7" stroke-opacity="0.35" />
      <line x1="20" y1="20" x2="20" y2="38" stroke="#7dd3fc" stroke-width="0.7" stroke-opacity="0.35" />
      <line x1="20" y1="20" x2="5"  y2="29" stroke="#7dd3fc" stroke-width="0.7" stroke-opacity="0.35" />
      <line x1="20" y1="20" x2="5"  y2="11" stroke="#7dd3fc" stroke-width="0.7" stroke-opacity="0.35" />
      <polygon points="20,2 35,29 5,29"  fill="none" stroke="#a5b4fc" stroke-width="0.65" stroke-opacity="0.3" />
      <polygon points="20,38 35,11 5,11" fill="none" stroke="#a5b4fc" stroke-width="0.65" stroke-opacity="0.3" />
      <circle cx="20" cy="2"  r="1.8" fill="#a5b4fc" />
      <circle cx="35" cy="11" r="1.8" fill="#a5b4fc" />
      <circle cx="35" cy="29" r="1.8" fill="#a5b4fc" />
      <circle cx="20" cy="38" r="1.8" fill="#a5b4fc" />
      <circle cx="5"  cy="29" r="1.8" fill="#a5b4fc" />
      <circle cx="5"  cy="11" r="1.8" fill="#a5b4fc" />
      <circle cx="20" cy="20" r="4"   fill="#7dd3fc" />
      <circle cx="20" cy="20" r="2.4" fill="#1a1a2e" />
      <circle cx="20" cy="20" r="1.3" fill="#7dd3fc" />
    </svg>
    <h1 class="text-[1.4rem] font-bold text-(--color-sky) m-0">MCP Tool Dashboard</h1>
  </div>

  <div class="mt-1 mb-3">
    <span
      class="inline-block text-xs px-2 py-0.5 rounded-full font-mono transition-colors duration-100"
      [class]="sse.status() === 'disconnected'
        ? 'bg-(--color-err)/15 text-(--color-err)'
        : 'bg-(--color-surface) text-(--color-muted)'">
      {{ sse.status() === 'connecting' ? 'connecting…' : sse.status() }}
    </span>
  </div>

  <!-- Error panel -->
  @if (sse.errors().length > 0) {
    <div class="mb-3 rounded-[4px] border border-(--color-err)/40 bg-(--color-err)/8 overflow-hidden shrink-0">
      <div class="flex items-center justify-between px-3 py-1.5 bg-(--color-err)/12 border-b border-(--color-err)/30">
        <span class="text-xs font-semibold text-(--color-err) uppercase tracking-[0.06em]">
          Process error{{ sse.errors().length > 1 ? 's (' + sse.errors().length + ')' : '' }}
        </span>
        <button
          class="text-xs text-(--color-err)/70 hover:text-(--color-err) font-mono cursor-pointer bg-transparent border-none px-1"
          (click)="sse.clearErrors()">dismiss ✕</button>
      </div>
      @for (e of sse.errors(); track e.ts) {
        <details class="border-b border-(--color-err)/20 last:border-0">
          <summary class="px-3 py-1.5 text-xs font-mono text-(--color-err) cursor-pointer select-none">
            <span class="text-(--color-muted) mr-2">{{ fmtTime(e.ts) }}</span>{{ e.message }}
          </summary>
          @if (e.stack) {
            <pre class="px-3 py-2 text-[0.7rem] leading-relaxed text-(--color-err)/75 overflow-x-auto m-0 whitespace-pre-wrap">{{ e.stack }}</pre>
          }
        </details>
      }
    </div>
  }

  <!-- Tab bar -->
  <div class="flex gap-0 border-b border-(--color-border) mb-3 shrink-0">
    <button
      class="px-4 py-1.5 text-[0.82rem] font-mono border-b-2 transition-colors duration-100 cursor-pointer bg-transparent"
      [class]="tab() === 'dashboard'
        ? 'border-(--color-indigo) text-(--color-indigo)'
        : 'border-transparent text-(--color-muted) hover:text-(--color-text)'"
      (click)="tab.set('dashboard')">Dashboard</button>
    <button
      class="px-4 py-1.5 text-[0.82rem] font-mono border-b-2 transition-colors duration-100 cursor-pointer bg-transparent"
      [class]="tab() === 'playground'
        ? 'border-(--color-indigo) text-(--color-indigo)'
        : 'border-transparent text-(--color-muted) hover:text-(--color-text)'"
      (click)="tab.set('playground')">Playground</button>
  </div>

  <!-- Tab content -->
  <div class="flex-1 min-h-0 overflow-hidden">

    @if (tab() === 'dashboard') {
      <div class="h-full flex flex-col min-h-0">

        <app-server-info [info]="init.serverInfo" />

        <h2 class="text-[0.9rem] font-semibold uppercase tracking-[0.07em] text-(--color-indigo)
                    mt-4 mb-1.5 pb-1 border-b border-(--color-border) shrink-0">Tool Stats</h2>
        <div class="overflow-y-auto max-h-[30vh] shrink-0 border border-(--color-border) rounded-[4px]">
          <app-stats-table [stats]="sse.stats()" />
        </div>

        <h2 class="text-[0.9rem] font-semibold uppercase tracking-[0.07em] text-(--color-indigo)
                    mt-4 mb-1.5 pb-1 border-b border-(--color-border) shrink-0 flex items-baseline gap-2">
          Request Log
          <span class="normal-case font-normal text-xs text-(--color-muted) tracking-normal">
            (newest first, max 500)
          </span>
        </h2>
        <div class="flex-1 min-h-0">
          <app-request-log [entries]="sse.log()" />
        </div>

      </div>
    }

    @if (tab() === 'playground') {
      <app-playground [schemas]="init.schemas" />
    }

  </div>

</div>
